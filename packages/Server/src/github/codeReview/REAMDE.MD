# 代码审查

## 1. 代码变更分析流程

我们采用整体分析而非逐文件审查的方式来处理 PR。具体流程如下：

1. 获取 PR 中所有变更文件
2. 将所有文件的 diff 内容整合为单一字符串
3. 将整合后的内容与 PR 标题、描述一并提交给大模型进行分析

大模型根据预设的提示词分析整体 diff 内容，并：

1. 通过 create_pr_summary 工具生成整体变更摘要
2. 利用 create_review_comment 工具对存在问题的代码位置添加评论

此方案优势：

- 大模型可获得完整的变更上下文视图
- 能够识别跨文件的关联性问题
- 减少 API 调用次数，提升效率

局限性：

- PR 变更过大可能超出模型上下文长度限制
- 难以对单个文件进行深入分析

审查重点：

- 代码逻辑缺陷
- 功能实现问题
- 潜在安全隐患
- 影响功能正常运行的错误

通过这种设计，大模型能够：

- 全面理解 PR 变更内容
- 提供高质量的变更概述
- 准确定位并评论具体问题
- 专注于实质性问题，忽略代码风格、样式等次要因素
