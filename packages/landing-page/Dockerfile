FROM node:18-alpine
WORKDIR /app

# # 接收构建参数
# ARG NODE_ENV
# ARG NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY
# ARG CLERK_SECRET_KEY
# ARG SUPABASE_URL
# ARG SUPABASE_KEY
# ARG SUPABASE_S3_ENDPOINT
# ARG SUPABASE_S3_REGION
# ARG SUPABASE_STORE_ID
# ARG SUPABASE_STORE_SECRET_KEY
# ARG SUPABASE_BUCKET_NAME
# ARG GITHUB_APP_ID
# ARG GITHUB_CLIENT_ID
# ARG GITHUB_CLIENT_SECRET
# ARG GITHUB_PRIVATE_KEY
# ARG DIFY_APIKEY
# ARG DIFY_BASE_URL

# # 设置环境变量
# ENV NODE_ENV=${NODE_ENV}
# ENV NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=${NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY}
# ENV CLERK_SECRET_KEY=${CLERK_SECRET_KEY}
# ENV SUPABASE_URL=${SUPABASE_URL}
# ENV SUPABASE_KEY=${SUPABASE_KEY}
# ENV SUPABASE_S3_ENDPOINT=${SUPABASE_S3_ENDPOINT}
# ENV SUPABASE_S3_REGION=${SUPABASE_S3_REGION}
# ENV SUPABASE_STORE_ID=${SUPABASE_STORE_ID}
# ENV SUPABASE_STORE_SECRET_KEY=${SUPABASE_STORE_SECRET_KEY}
# ENV SUPABASE_BUCKET_NAME=${SUPABASE_BUCKET_NAME}
# ENV GITHUB_APP_ID=${GITHUB_APP_ID}
# ENV GITHUB_CLIENT_ID=${GITHUB_CLIENT_ID}
# ENV GITHUB_CLIENT_SECRET=${GITHUB_CLIENT_SECRET}
# ENV GITHUB_PRIVATE_KEY=${GITHUB_PRIVATE_KEY}
# ENV DIFY_APIKEY=${DIFY_APIKEY}
# ENV DIFY_BASE_URL=${DIFY_BASE_URL}

# 复制整个项目文件
COPY . .

# 安装依赖并构建
RUN npm install -g pnpm && \
    pnpm install && \
    cd packages/landing-page && \
    pnpm build

# 设置工作目录
WORKDIR /app/packages/landing-page

# 暴露端口
EXPOSE 3000

# 启动 Next.js
CMD ["pnpm", "start"] 