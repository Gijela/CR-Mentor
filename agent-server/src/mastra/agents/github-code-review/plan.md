# GitHub 代码审查 Agent 系统方案 (简化版)

## 核心流程

该系统通过协调器 (`github-code-review`) 和差异分析服务 (`github-diff-review`) 协作完成 PR 审查。

1.  **启动审查**

    - **输入:** PR 标识符 (owner, repo, pull_number)。
    - **处理:** 协调器 Agent 被触发。

2.  **获取 PR 信息 (协调器)**

    - **输入:** PR 标识符。
    - **处理:** 协调器调用 GitHub API 获取 PR 详情。
    - **输出:** PR 元数据 (包含文件列表、描述等)。

3.  **分发文件审查任务 (协调器) (对每个文件)**

    - **输入:** 单个文件路径 (`filePath`) 及必要的 PR 上下文 (`owner`, `repo`, `pull_number`, `prDescription`)。
    - **处理:** 协调器向差异分析服务发送 HTTP 请求，要求审查该文件。
    - **输出:** 发往差异分析服务的 HTTP 请求。

4.  **执行文件分析 (差异服务)**

    - **输入:** 来自协调器的 HTTP 请求 (包含 `owner`, `repo`, `pull_number`, `filePath`, `prDescription`)。
    - **处理:** 差异服务内部调用 GitHub API 获取文件内容和 diff，进行分析。
    - **输出:** 单个文件的审查报告 (JSON 格式，遵循 `DiffReviewOutputSchema`)，通过 HTTP 响应返回。

5.  **汇总审查结果 (协调器)**

    - **输入:** 所有（成功返回的）单个文件审查报告。
    - **处理:** 协调器聚合所有报告，生成最终摘要。
    - **输出:** 聚合后的审查报告 (文本或结构化数据)。

6.  **发布评论 (协调器)**
    - **输入:** 聚合后的审查报告 和 PR 标识符。
    - **处理:** 协调器调用 GitHub API 将报告发布为 PR 评论。
    - **输出:** 评论发布到 GitHub PR。

## Agent 职责

- **协调器:** 驱动流程、与 GitHub PR 交互、任务分发、结果汇总、发布评论。
- **差异服务:** 接收文件审查请求、获取代码细节、执行代码分析、返回单文件报告。
